<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Country Converter update 0.7.3 | Konstantin Stadler</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/custom.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://konstantinstadler.site/posts/country_converter_073/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Konstantin Stadler">
<link rel="prev" href="../exiobase-update-v38/" title="EXIOBASE update: v3.8" type="text/html">
<link rel="next" href="../my-code-in-ice/" title="My code in ice" type="text/html">
<meta property="og:site_name" content="Konstantin Stadler">
<meta property="og:title" content="Country Converter update 0.7.3">
<meta property="og:url" content="https://konstantinstadler.site/posts/country_converter_073/">
<meta property="og:description" content="Two points learned from compiling a new release of the country converter coco.

First and as always, the new developments for the country converter can be found in the CHANGELOG file.
Just to highligh">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-04-09T14:12:00+02:00">
<meta property="article:tag" content="python">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin="anonymous">
</head>
<body>

<!-- Sidebar -->
<div id="wrapper">
   <div class="overlay" style="max-width:300px"></div>

   <!-- Sidebar -->
   <nav class="navbar navbar-inverse fixed-top" style="background: #073642" , id="sidebar-wrapper" role="navigation"><ul class="nav sidebar-nav">
<div class="sidebar-header">
               <div class="sidebar-brand">
                  <a href="../../">
                  <img src="../../images/20201030_122424.jpg" style="max-width: 65%" alt="Konstantin"></a>
                   <h4>
                      <a href="../../about/">Konstantin Stadler</a>
                  </h4>
                   <p> Research Software Engineer <br>
                   Scientist </p>
                   <p>Follow me:  
                   <a href="https://www.twitter.com/kst_stadler/">
                   <i class="fa fa-twitter" aria-hidden="true"></i>
                   |
                   </a>
                   <a href="https://github.com/konstantinstadler/">
                   <i class="fa fa-github" aria-hidden="true"></i>
                   |
                   </a>
                   <a href="https://gitlab.com/konstantinstadler/">
                   <i class="fa fa-gitlab" aria-hidden="true"></i>
                   |
                   </a>
                   <a href="https://no.linkedin.com/in/konstantinstadler/">
                   <i class="fa fa-linkedin" aria-hidden="true"></i>
                   </a>

               </p>
</div>
           </div>

           <ul class="navbar-nav mr-auto">
                
               <br>
                
               
                <li class="nav-item">
<a href="../../" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../../publications" class="nav-link">Publications</a>
                </li>
<li class="nav-item">
<a href="../../projects" class="nav-link">Projects</a>
                </li>
<li class="nav-item">
<a href="../../presentations" class="nav-link">Presentations</a>
                </li>
<li class="nav-item">
<a href="../../blog" class="nav-link">Blog</a>
                </li>
<li class="nav-item">
<a href="../../about" class="nav-link">About Me</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>

               
           </li>
</ul>
<span class="navbar-text">
             <i class="fa fa-copyright" aria-hidden="true"></i>  
             Konstantin Stadler. Licenced under
             <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
         </span>

       </ul></nav><!-- /#sidebar-wrapper --><!-- End of Sidebar --><!-- Page Content --><div id="page-content-wrapper">
    <button type="button" class="hamburger animated fadeInLeft is-closed" data-toggle="offcanvas">
    <span class="hamb-top"></span>
    <span class="hamb-middle"></span>
    <span class="hamb-bottom"></span>
</button>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Country Converter update 0.7.3</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Konstantin Stadler
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-04-09T14:12:00+02:00" itemprop="datePublished" title="2021-04-09 14:12">2021-04-09 14:12</time></a>
            </p>
            
        <p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>Two points learned from compiling a new release of the <a class="reference external" href="https://github.com/konstantinstadler/country_converter">country converter coco</a>.</p>
<!-- TEASER_END -->
<p>First and as always, the new developments for the country converter can be found in the <a class="reference external" href="https://github.com/konstantinstadler/country_converter/blob/master/CHANGELOG.rst">CHANGELOG file</a>.</p>
<p>Just to highlight to vaguely related things:</p>
<section id="using-pytest-for-testing-administrative-package-content"><h2>Using pytest for testing administrative package content</h2>
<p>I tend to forget to update the version in the <em>version.py</em>
file and the one in the <em>CHANGELOG.rst</em> . Most of the time these are not aligned
which occasionally leads to some headache for the release on the pypi test
server.</p>
<p>So I finally decided to add a test case for this stuff.</p>
<p>By no means something complicated to do once I released that I can use <a class="reference external" href="https://docs.pytest.org/en/stable/">pytest</a> for this task.</p>
<p>So the tests in country converter now include a function which parse the first version number found
in the <em>CHANGELOG.rst</em> file and compares it to the version given in the <em>version.py</em>
file:</p>
<div class="code"><pre class="code python"><a id="rest_code_5ba327d3727a442284831b00cb5406ac-1" name="rest_code_5ba327d3727a442284831b00cb5406ac-1" href="#rest_code_5ba327d3727a442284831b00cb5406ac-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-2" name="rest_code_5ba327d3727a442284831b00cb5406ac-2" href="#rest_code_5ba327d3727a442284831b00cb5406ac-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-3" name="rest_code_5ba327d3727a442284831b00cb5406ac-3" href="#rest_code_5ba327d3727a442284831b00cb5406ac-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-4" name="rest_code_5ba327d3727a442284831b00cb5406ac-4" href="#rest_code_5ba327d3727a442284831b00cb5406ac-4"></a>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-5" name="rest_code_5ba327d3727a442284831b00cb5406ac-5" href="#rest_code_5ba327d3727a442284831b00cb5406ac-5"></a><span class="n">TESTPATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-6" name="rest_code_5ba327d3727a442284831b00cb5406ac-6" href="#rest_code_5ba327d3727a442284831b00cb5406ac-6"></a><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTPATH</span><span class="p">,</span> <span class="s2">".."</span><span class="p">))</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-7" name="rest_code_5ba327d3727a442284831b00cb5406ac-7" href="#rest_code_5ba327d3727a442284831b00cb5406ac-7"></a>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-8" name="rest_code_5ba327d3727a442284831b00cb5406ac-8" href="#rest_code_5ba327d3727a442284831b00cb5406ac-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">country_converter</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">coco</span>  <span class="c1"># noqa</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-9" name="rest_code_5ba327d3727a442284831b00cb5406ac-9" href="#rest_code_5ba327d3727a442284831b00cb5406ac-9"></a>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-10" name="rest_code_5ba327d3727a442284831b00cb5406ac-10" href="#rest_code_5ba327d3727a442284831b00cb5406ac-10"></a><span class="n">CHANGELOG_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTPATH</span><span class="p">,</span> <span class="s2">".."</span><span class="p">,</span> <span class="s2">"CHANGELOG.rst"</span><span class="p">)</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-11" name="rest_code_5ba327d3727a442284831b00cb5406ac-11" href="#rest_code_5ba327d3727a442284831b00cb5406ac-11"></a>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-12" name="rest_code_5ba327d3727a442284831b00cb5406ac-12" href="#rest_code_5ba327d3727a442284831b00cb5406ac-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_version_consistency</span><span class="p">():</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-13" name="rest_code_5ba327d3727a442284831b00cb5406ac-13" href="#rest_code_5ba327d3727a442284831b00cb5406ac-13"></a><span class="w">    </span><span class="sd">"""Test CHANGELOG.rst latest version consistency with module version"""</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-14" name="rest_code_5ba327d3727a442284831b00cb5406ac-14" href="#rest_code_5ba327d3727a442284831b00cb5406ac-14"></a>    <span class="n">version_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\d+\.\d+\.\d+[a-zA-Z0-9_.]*"</span><span class="p">)</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-15" name="rest_code_5ba327d3727a442284831b00cb5406ac-15" href="#rest_code_5ba327d3727a442284831b00cb5406ac-15"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">CHANGELOG_FILE</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">cf</span><span class="p">:</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-16" name="rest_code_5ba327d3727a442284831b00cb5406ac-16" href="#rest_code_5ba327d3727a442284831b00cb5406ac-16"></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cf</span><span class="p">:</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-17" name="rest_code_5ba327d3727a442284831b00cb5406ac-17" href="#rest_code_5ba327d3727a442284831b00cb5406ac-17"></a>            <span class="n">pot_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">version_match</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-18" name="rest_code_5ba327d3727a442284831b00cb5406ac-18" href="#rest_code_5ba327d3727a442284831b00cb5406ac-18"></a>            <span class="k">if</span> <span class="n">pot_match</span><span class="p">:</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-19" name="rest_code_5ba327d3727a442284831b00cb5406ac-19" href="#rest_code_5ba327d3727a442284831b00cb5406ac-19"></a>                <span class="n">version_changelog</span> <span class="o">=</span> <span class="n">pot_match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-20" name="rest_code_5ba327d3727a442284831b00cb5406ac-20" href="#rest_code_5ba327d3727a442284831b00cb5406ac-20"></a>                <span class="k">break</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-21" name="rest_code_5ba327d3727a442284831b00cb5406ac-21" href="#rest_code_5ba327d3727a442284831b00cb5406ac-21"></a>        <span class="k">else</span><span class="p">:</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-22" name="rest_code_5ba327d3727a442284831b00cb5406ac-22" href="#rest_code_5ba327d3727a442284831b00cb5406ac-22"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"No version information found in the CHANGELOG file"</span><span class="p">)</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-23" name="rest_code_5ba327d3727a442284831b00cb5406ac-23" href="#rest_code_5ba327d3727a442284831b00cb5406ac-23"></a>    <span class="k">assert</span> <span class="p">(</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-24" name="rest_code_5ba327d3727a442284831b00cb5406ac-24" href="#rest_code_5ba327d3727a442284831b00cb5406ac-24"></a>        <span class="n">coco</span><span class="o">.</span><span class="n">__version__</span> <span class="o">==</span> <span class="n">version_changelog</span>
<a id="rest_code_5ba327d3727a442284831b00cb5406ac-25" name="rest_code_5ba327d3727a442284831b00cb5406ac-25" href="#rest_code_5ba327d3727a442284831b00cb5406ac-25"></a>    <span class="p">),</span> <span class="s2">"Version module - CHANGELOG.rst do not match"</span>
</pre></div>
<p>For more details see <a class="reference external" href="https://github.com/konstantinstadler/country_converter/blob/master/tests/test_admin.py">the actual test file here.</a></p>
</section><section id="same-example-script-for-parsing-data-for-a-new-classification"><h2>Same example script for parsing data for a new classification</h2>
<p>The main obstacle for adding a new classification to the country converter is
to parse the classification from some given country data file.
For version 0.7.3 I did that for the <a class="reference external" href="http://ghdx.healthdata.org/">Global Burden of Disease</a> country codes.
You can find the <a class="reference external" href="https://gist.github.com/konstantinstadler/dc3583a4674a39def0d4611c095eb788">gist of it here.</a>
For most cases this should be easily adaptable to other classification
schemes.</p>
<p>Thats all folks, happy converting!</p>
</section>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../exiobase-update-v38/" rel="prev" title="EXIOBASE update: v3.8">Previous post</a>
            </li>
            <li class="next">
                <a href="../my-code-in-ice/" rel="next" title="My code in ice">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer"><a href="../../">Home</a>
            
            
            
        </footer>
</div>
</div>
</div>
<!-- /#page-content-wrapper -->
</div>
<!-- /#wrapper -->


            <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/sidebar.js"></script>'
</body>
</html>
